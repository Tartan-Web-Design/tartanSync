# tartanSync

## How to install tartanSync

Tartansync requires the following:

- wp-cli 
  - To be installed, and available through the alias "wp"
  - NB, this link: https://wp-cli.org has the most up to date how-to on doing this.
  - Be sure to test that the alias and executable is functioning by openning a new term and typing "wp".  You should get a help screen.

Setting up WP-CLI
=================


Download the lastest version from - https://raw.github.com/wp-cli/builds/gh-pages/phar/wp-cli.phar 
Make it executable - chmod +x wp-cli.phar
Check it works - ./wp-cli.phar --info
Move it to bin to allow it to be executed from anywhere.  
	On a mac, thats - mv /Users/scott/Dropbox/Tartan/git/tartanSync/wp-cli.phar /usr/local/bin/wp
	On Ubuntu it's - /usr/local/bin/
Retest - wp --info

NB, if this is on the server, then run it using the USER generated by Plesk for the website in question.  E.g.

	sudo -u tartan -i -- wp --info

Also, NB, on the server, the below configuration isn't required as wp-cli is available through plesk toolkit

For each Local website, need to change wp-config.php as follows:

	Click the (i) icon next to the version of PHP in Local
	Look for the line - Loaded Configuration File	
		It should have something like this in it - /Users/scott/Library/Application Support/Local/run/y2BiwWIa2/conf/php/php.ini
		
		NB, on Plesk, here's how to get to the same browser display for php:
			Domains > example.com > PHP Settings > View the phpinfo() page 
		
		Copy the string between /run/ and /conf/ to a notepad.  In this example it's y2BiwWIa2
		Find the location of mysqld.sock.  On my machine it's:
			/Users/scott/Library/Application\ Support/Local/run/y2BiwWIa2/mysql/mysqld.sock
			NB: Note that part of this path is the string saved above.
		Save that location in a notepad.
	Find wp-config.php and open it in an editor
	Search for the lines:
		/** MySQL hostname */
		define( 'DB_HOST', 'localhost' );
	Change to:
		/** MySQL hostname */
		define( 'DB_HOST', 'localhost:/Users/scott/Library/Application Support/Local/run/y2BiwWIa2/mysql/mysqld.sock' );
		
	NB, as this previous line has quotes round it, it doesn't need the backslash to denote the space in 'Application Support'

	In the same location as that wp-config.php file, test by:
		wp plugin list
	you should see a list of the plugins, drawn from the database for that site.
	NB, if you get a database error, something's gone wrong with the above.




- mysql
  - See https://dev.mysql.com/doc/mysql-osx-excerpt/5.7/en/osx-installation-pkg.html
  - NB, ensure that the path to mysql is included in ENV.  
    - export PATH=${PATH}:/usr/local/mysql/bin/
    - source ~/.zshrc

- Tartansync
  - Download or git pull Tartansync to your local machine
  - Ensure that the path to the location of Tartansync is included in ENV.
    - export PATH=${PATH}:/Users/scott/Dropbox/Tartan/git/tartanSync/
    - source ~/.zshrc
  - Add an alias to reducing typing strain:
    - nano ~/.zshrc
    - alias tartanSync="bash tartanSync.sh"
  
 ## How to use tartanSync
 
 Tartansync assumes that you're pushing and pulling between a LocalbyFlywheel wordpress site and a Plesk wordpress site.
 
 Usage is:
  - tartanSync.sh [<pull|push>] [Source] [Destination], where:
    - For Pull
      - Source: Remote website on the plesk server.  E.g. test.wildcamping.scot
      - Destination: Local site (the folder name, not the .local name.)  E.g. testwildcampingscot
    - For Push
      - Source: Local site (the folder name, not the .local name.0  E.g. testwildcampingscot
      - Destination: Remote website on the plesk server.  E.g. test.wildcamping.scot
      
 ## Flow
 
 The script does the following:
 
  1. Checks to see if what you've asked makes sense, and whether it can find the directories in question.
  2. For wp-content, asks whether this is a full run, dry run or roll-back.
  3. Executes the command (full run | dry run | roll-back) for wp-content
  4. For database sync, asks whether this is a full run, dry run or roll-back.
  5. Executes the command (full run | dry run | roll-back) for the database.
  
 ## Things to note
 
 - The roll-back attempts to return the system to the same state as it was immediately before your last command, but only to one level.
 - You can full run, dry run and roll-back each of wp-content and the database individually.  Be careful here, as during roll-back, it is pulling the backup from the last time that particular option had a full-run.  That might not be your last command.

 
